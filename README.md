# yamdb_final

![CI](https://github.com/rshafikov/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg?branch=master)

# api_YaMDB
API проекта YaMDB, который собирает отзывы пользователей на произведения.
## Описание
Проект YaMDB собирает отзывы (Review) пользователей на произведения (Titles). Произведения делятся на категории: «Книги», «Фильмы», «Музыка». Список категорий (Category) может быть расширен администратором (например, можно добавить категорию «Изобразительное искусство» или «Ювелирка»).
Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.
В каждой категории есть произведения: книги, фильмы или музыка. Например, в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» и «Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы «Насекомые» и вторая сюита Баха.
Произведению может быть присвоен жанр (Genre) из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.
Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы (Review) и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). На одно произведение пользователь может оставить только один отзыв.

API предоставляет следующие возможности
####  всем пользователям вне зависимости от аутентификации:
- зарегистрироваться на проекте в качестве нового пользователя, получить JWT-токен для взаимодействия с ресурсами проекта;
- просматривать список категорий произведений с возможностью поиска категорий по названию (name), используя параметр search;
- просматривать список жанров произведений с возможностью поиска жанров по названию (name), используя параметр search;
- просматривать список произведений с возможностью фильтрации произведений по названию (name), году выпуска (year), жанру (genre) и категории (category);
- просматривать информацию о любом произведении, выбранном по уникальному номеру записи в БД (title_id);
- просматривать список отзывов к произведению, выбранному по уникальному номеру записи в БД (title_id);
- просматривать информацию о любом отзыве, выбранном по уникальному номеру записи в БД (review_id) на произведение, выбранное по уникальному номеру записи в БД (title_id);
- просматривать список комментариев к отзыву, выбранному по уникальному номеру записи в БД (review_id) на произведение, выбранное по уникальному номеру записи в БД (title_id);
- просматривать информацию о любом комментарии, выбранном по уникальному номеру записи в БД (comment_id) к отзыву, выбранному по уникальному номеру записи в БД (review_id) на произведение, выбранное по уникальному номеру записи в БД (title_id).
#### аутентифицированным пользователям:
- публиковать отзывы на произведения;
- редактировать и удалять свои отзывы;
- комментировать отзывы на произведения;
- редактировать и удалять свои комментарии;
- просматривать и редактировать данные своей учётной записи.
#### администраторам проекта:
- добавлять и удалять категории произведений;
- добавлять и удалять жанры произведений;
- добавлять, редактировать и удалять произведения;
- редактировать и удалять отзывы пользователей проекта;
- редактировать и удалять комментарии пользователей проекта к отзывам;
- просматривать список пользователей проекта;
- добавлять новых пользователей;
- просматривать информацию о любом пользователе, выбранном по уникальной записи в БД (username);
- редактировать данные любого пользователя, выбранного по уникальной записи в БД (username);
- удалять любого пользователя, выбранного по уникальной записи в БД (username).
#### модераторам проекта:
- редактировать и удалять отзывы пользователей проекта;
- редактировать и удалять комментарии пользователей проекта к отзывам.
### Технологии
- Python 3.7
- Django 2.2.16
- Django REST Framework 3.12.4
- Django REST Framework Simple JWT 5.2.0
### Запуск проекта в dev-режиме
- Установите ...
```
python -m venv venv
``` 
- ... и активируйте виртуальное окружение
```
source/venv/Scripts/activate
```
- Установите зависимости из файла requirements.txt
```
pip install -r requirements.txt
``` 
- Создайте ...
```
python manage.py makemigrations
``` 
- ... и выполните миграции
```
python manage.py migrate
``` 
- Наполните базу данных информацией из .csv файлов
```
python manage.py importcsv
```
- Запустите сервер в режиме разработки
```
python manage.py runserver
```
### Алгоритм регистрации пользователей
- Пользователь отправляет POST-запрос на добавление нового пользователя с параметрами email и username на следующий эндпоинт:
```
api/v1/auth/signup/
```
Пример:
```
POST http://127.0.0.1:8000/api/v1/auth/signup/
Content-Type: application/json

{
  "username": "fakeuser",
  "email": "fakeuser@fakeemail.ru"
}
```
- Проект YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на адрес email.
- Для получения JWT-токена пользователь отправляет POST-запрос с параметрами username и confirmation_code на следующий эндпоинт:
```
api/v1/auth/token/
```
Пример:
```
POST http://127.0.0.1:8000/api/v1/auth/token/
Content-Type: application/json

{
  "username": "fakeuser",
  "confirmation_code": "624-c1c04b4c34db07ecd9ff"
}
```
- Для заполнения (при желании) полей в своём профайле пользователь отправляет PATCH-запрос на следующий эндпоинт:
```
api/v1/users/me/
```
Для взаимодействия с ресурсами проекта, доступными только аутентифицированным пользователям, при каждом новом запросе необходимо указывать полученный JWT-токен с приставкой Bearer в поле Authorization.
Пример:
```
PATCH http://127.0.0.1:8000/api/v1/titles/72/reviews/4/
Content-Type: application/json
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjU1NzIwOTQwLCJqdGkiOiI5M2I5ODg2ZjdkZDc0YmMxYWZiMWZkMWVmZWU2YTdmMSIsInVzZXJfaWQiOjF9.fZV-NnpTmrQsVDDOOITub4kewp53ZcQ6pI99JD9-1RI

{
  "text": "Обновленный текст отзыва",
  "score": 7
}
```
### Эндпоинты, доступные в проекте:
1. Регистрация (POST- запрос) нового пользователя
```
api/v1/auth/signup/
```
2. Получение (POST- запрос) JWT-токена
```
api/v1/auth/token/
```
3. Просмотр (GET- запрос) списка категорий произведений, добавление (POST- запрос) новой категории
```
api/v1/categories/
```
4. Удаление (DELETE- запрос) категории произведения, выбранной по уникальной записи в БД (slug)
```
api/v1/categories/{slug}/
```
5. Просмотр (GET- запрос) списка жанров произведений, добавление (POST- запрос) нового жанра
```
api/v1/genres/
```
6. Удаление (DELETE- запрос) жанра произведения, выбранного по уникальной записи в БД (slug)
```
api/v1/genres/{slug}/
```
7. Просмотр (GET- запрос) списка произведений, добавление (POST- запрос) нового произведения
```
api/v1/titles/
```
8. Просмотр (GET- запрос) подробной информации, редактирование (PATCH- запрос) и удаление (DELETE- запрос) произведения, выбранного по уникальному номеру записи в БД (title_id)
```
api/v1/titles/{title_id}/
```
9. Просмотр (GET- запрос) списка отзывов, добавление (POST- запрос) отзыва к произведению, выбранному по уникальному номеру записи в БД (title_id)
```
api/v1/titles/{title_id}/reviews/
```
10. Просмотр (GET- запрос) подробной информации, редактирование (PATCH- запрос) и удаление (DELETE- запрос) отзыва, выбранного по уникальному номеру записи в БД (review_id) на произведение, выбранное по уникальному номеру записи в БД (title_id)
```
api/v1/titles/{title_id}/reviews/{review_id}/
```
11. Просмотр (GET- запрос) списка комментариев, добавление (POST- запрос) комментария к отзыву, выбранному по уникальному номеру записи в БД (review_id) на произведение, выбранное по уникальному номеру записи в БД (title_id)
```
api/v1/titles/{title_id}/reviews/{review_id}/comments/
```
12. Просмотр (GET- запрос) подробной информации, редактирование (PATCH- запрос) и удаление (DELETE- запрос) комментария, выбранного по уникальному номеру записи в БД (comment_id) к отзыву, выбранному по уникальному номеру записи в БД (review_id) на произведение, выбранное по уникальному номеру записи в БД (title_id)
```
api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/
```
13. Просмотр (GET- запрос) списка пользователей проекта, добавление (POST- запрос) нового пользователя
```
api/v1/users/
```
14. Просмотр (GET- запрос) подробной информации, редактирование (PATCH- запрос) и удаление (DELETE- запрос) пользователя проекта, выбранного по уникальной записи в БД (username)
```
api/v1/users/{username}/
```
### Авторы
- Рамиль Шафиков
